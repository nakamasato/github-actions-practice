name: github-script

on: pull_request

# module.exports = ({ github, context }) => {
#     const output = `*Pusher: @${github.actor}, Action: \`${github.event_name}\`, Working Directory: \`${env.tf_actions_working_dir}\`, Workflow: \`${github.workflow}\`*`;
#     github.issues.createComment({
#         issue_number: context.issue.number,
#         owner: context.repo.owner,
#         repo: context.repo.repo,
#         body: output
#     })
# }

# const output = `#### Terraform Format and Style üñå\`${steps.fmt.outcome }\`
# #### Terraform Initialization ‚öôÔ∏è\`${ steps.init.outcome }\`
# #### Terraform Validation ü§ñ${ steps.validate.outputs.stdout }
# #### Terraform Plan üìñ\`${ steps.plan.outcome }\`
# <details><summary>Show Plan</summary>

# \`\`\`${ process.env.PLAN }\`\`\`

# </details>
# *Pusher: @${ github.actor }, Action: \`${ github.event_name }\`, Working Directory: \`${ env.tf_actions_working_dir }\`, Workflow: \`${ github.workflow }\`*`;


jobs:
  echo-input:
    env:
      ENV_FOR_JOB: env for job
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/github-script@v5
        env:
          PLAN: steps.plan.outcome
          FMT: steps.fmt.outcome
          INIT: steps.init.outcome
          VALIDATION: steps.validate.outputs.stdout
        with:
          script: |
            console.log(context)
            process.env
            const { RESULT } = process.env

            const output = `#### Terraform Format and Style üñå\`${ process.env.FMT }\`
            #### Terraform Initialization ‚öôÔ∏è\`${ process.env.INIT }\`
            #### Terraform Validation ü§ñ${ process.env.VALIDATION }
            #### Terraform Plan üìñ\`${ process.env.PLAN }\`
            <details><summary>Show Plan</summary>

            \`\`\`${ process.env.PLAN }\`\`\`

            </details>
            *Pusher: @${context.actor}, Action: \`${context.eventName}\`, Working Directory: \`${ process.env.ENV_FOR_JOB }\`, Workflow: \`${context.workflow}\`*`;

            github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: output
            })
          #   const script = require('./.github/actions/script.js')
          #   console.log(script({github, context}))
